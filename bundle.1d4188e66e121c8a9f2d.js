!function(){"use strict";class t{constructor(t){this.$el="string"==typeof t?document.querySelector(t):t}html(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML.trim()}clear(){return this.html(""),this}on(t,e){this.$el.addEventListener(t,e)}off(t,e){this.$el.removeEventListener(t,e)}append(e){return e instanceof t&&(e=e.$el),Element.prototype.append?this.$el.append(e):this.$el.appendChild(e),this}closest(t){return e(this.$el.closest(t))}getCoords(){return this.$el.getBoundingClientRect()}find(t){return e(this.$el.querySelector(t))}findAll(t){return this.$el.querySelectorAll(t)}css(t){return Object.keys(t).forEach((e=>this.$el.style[e]=t[e])),this}get data(){return this.$el.dataset}addClass(t){return this.$el.classList.add(t),this}removeClass(t){this.$el.classList.remove(t)}id(){const t=this.$el.dataset.id;return[t[0],+t.slice(1)]}focus(){return this.$el.focus(),this}text(t){return"string"==typeof t?(this.$el.textContent=t,this):this.$el.textContent.trim()}getStyles(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((t,e)=>(t[e]=this.$el.style[e],t)),{})}}function e(e){return new t(e)}e.create=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=document.createElement(t);return n&&r.classList.add(n),e(r)};class n{constructor(){this.listeners={}}emit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return!!Array.isArray(this.listeners[t])&&(this.listeners[t].forEach((t=>{t(...n)})),!0)}subscribe(t,e){return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e),()=>{this.listeners[t]=this.listeners[t].filter((t=>t!==e))}}}function r(t,e){if(!e)return JSON.parse(localStorage.getItem(t));localStorage.setItem(t,JSON.stringify(e))}class i{constructor(t){this.store=t,this.sub=null,this.prevState={}}subscribeComponents(t){this.prevState=this.store.getState(),this.sub=this.store.subscribe((e=>{Object.keys(e).forEach((n=>{var r,i;r=this.prevState[n],i=e[n],("object"==typeof r&&"object"==typeof i?JSON.stringify(r)===JSON.stringify(i):r===i)||t.forEach((t=>{if(t.subscribe.includes(n)){const r={[n]:e[n]};t.storeChanged(r)}}))})),this.prevState=this.store.getState()}))}unsubscribeFromStore(){this.sub.unsubscribe()}}class s{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t)throw new Error("No $root provided to DomListener");this.$root=t,this.listeners=e}initDomListeners(){this.listeners.forEach((t=>{const e=o(t);if(!this[e])throw new Error("listener ".concat(t," doesn't have ").concat(e," method"));this[e]=this[e].bind(this),this.$root.on(t,this[e])}))}removeDomListeners(){this.listeners.forEach((t=>{const e=o(t);this.$root.off(t,this[e])})),this.listeners=[]}}function o(t){return"on"+("string"!=typeof(e=t)?"":e.at(0).toUpperCase()+e.slice(1));var e}class a extends s{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,e.listeners),this.name=e.name||"",this.emitter=e.emitter,this.subscribe=e.subscribe||[],this.store=e.store,this.unsubs=[],this.storeSub=null,this.prepare()}prepare(){}toHTML(){return""}init(){this.initDomListeners()}$emit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.emitter.emit(t,...n)}$on(t,e){const n=this.emitter.subscribe(t,e);this.unsubs.push(n)}$dispatch(t){this.store.dispatch(t)}storeChanged(){}destroy(){this.removeDomListeners(),this.unsubs.forEach((t=>t()))}}class c extends a{constructor(t,e){super(t,{name:"Header",...e})}toHTML(){return'<div class="excel__header">\n\n            <input class="input" type="text" value="New table"/>\n\n            <div>\n                <div class="button">\n                    <i class="material-icons">delete</i>\n                </div>\n                <div class="button">\n                    <i class="material-icons">exit_to_app</i>\n                </div>\n            </div>'}}var l,u,h;function d(t){const e='data-type="button"\n    data-value=\''.concat(JSON.stringify(t.value),"'"),n=t.active?"active":"";return'<div class="button '.concat(n,'" ').concat(e,'>\n        <i class="material-icons" ').concat(e,">").concat(t.icon,"</i>\n    </div>")}function f(t){return[{icon:"format_align_left",active:!t||"left"===t.textAlign,value:{textAlign:(t&&t.textAlign,"left")}},{icon:"format_align_center",active:!!t&&"center"===t.textAlign,value:{textAlign:t&&"center"===t.textAlign?"left":"center"}},{icon:"format_align_right",active:!!t&&"right"===t.textAlign,value:{textAlign:t&&"right"===t.textAlign?"left":"right"}},{icon:"format_bold",active:!!t&&"bold"===t.fontWeight,value:{fontWeight:t&&"bold"===t.fontWeight?"normal":"bold"}},{icon:"format_italic",active:!!t&&"italic"===t.fontStyle,value:{fontStyle:t&&"italic"===t.fontStyle?"normal":"italic"}},{icon:"format_underlined",active:!!t&&"underline"===t.textDecoration,value:{textDecoration:t&&"underline"===t.textDecoration?"none":"underline"}}].map(d).join("")}l=c,h="excel__header",(u=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(u="className"))in l?Object.defineProperty(l,u,{value:h,enumerable:!0,configurable:!0,writable:!0}):l[u]=h;class p extends a{constructor(){super(...arguments)}get template(){return JSON.stringify(this.state,null,2)}initState(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state={...t}}setState(t){this.state={...this.state,...t},this.$root.html(this.template)}}const m={textAlign:"left",fontWeight:"normal",textDecoration:"none",fontStyle:"normal"};class v extends p{constructor(t,e){super(t,{name:"Toolbar",listeners:["click"],...e})}prepare(){this.initState(m)}get template(){return f(this.state)}toHTML(){return f()}onClick(t){const n=e(t.target);if("button"===n.data.type){const t=JSON.parse(n.data.value);this.$emit("toolbar:applyStyle",t);const e=Object.keys(t)[0];this.setState({[e]:t[e]})}}}!function(t,e,n){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(v,"className","excel__toolbar");class b extends a{constructor(t,e){super(t,{name:"Formula",listeners:["input","keydown"],subscribe:["textState"],...e})}init(){super.init(),this.$formula=this.$root.find("#formula"),this.$on("table:select",(t=>{this.$formula.text(t.text())}))}toHTML(){return'\n            <div class="info">\n                fx\n            </div>\n            <div id="formula" class="input" contenteditable spellcheck="false">\n            </div>\n        '}storeChanged(t){}onInput(t){const n=e(t.target).text();this.$emit("formula:input",n)}onKeydown(t){"Enter"===t.key&&(t.preventDefault(),this.$emit("formula:done"))}}!function(t,e,n){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(b,"className","excel__formula");const g={A:65,Z:90},y=25,S=120;function w(t,e){return(t.colState?t.colState[e]:S)+"px"}function x(t,e){return(t.rowState?t.rowState[e]:y)+"px"}function $(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const r=t?'<div class="row-resize" data-resize="row"></div>':"",i=t?'data-row="'.concat(t,'"'):"";return'\n    <div class="row" data-type="resizable" '.concat(i,' style="height: ').concat(n,'">\n        <div class="row-info" >').concat(t||""," ").concat(r,'</div>\n        <div class="row-data">').concat(e,"</div>\n    </div>\n    ")}function C(t,e){return String.fromCharCode(g.A+e)}function A(t,e){return function(n,r){const i=C(0,r),s=w(t,i),o=function(t,e,n){return t.textState?t.textState["".concat(e).concat(n)]:""}(t,i,e);return function(t,e,n,r){return'\n       <div class="cell" \n       data-row="'.concat(e,'" \n       data-col="').concat(t,'" \n       data-id="').concat(t).concat(e,'" \n       data-type="clickable"\n       contenteditable\n       style="width: ').concat(n,'"\n       >').concat(r||"","</div>\n    ")}(i,e,s,o)}}class E{constructor(){this.group=[],this.currentCell=null}get selectedIds(){return this.group.map((t=>t.id()))}reset(){0!==this.group.length&&(this.group.forEach((t=>{t.removeClass("selected")})),this.group=[])}applyStyling(t){this.group.forEach((e=>{t&&(e=e.css(t)),e.focus().addClass("selected")}))}select(t){this.reset(),this.group.push(t),this.applyStyling(),this.currentCell=t}selectGroup(t){this.reset(),this.group=t,this.applyStyling()}}const _="TABLE_RESIZE",L="CELL_TEXT";function j(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class T extends a{constructor(t,e){super(t,{name:"Table",listeners:["mousedown","keydown","input"],subscribe:["textState","colState","rowState"],...e}),j(this,"rowsCount",20)}init(){super.init(),this.selection=new E;const t=this.$root.find('[data-id="A1"]');this.selection.select(t),this.$emit("table:select",t),this.$on("formula:input",(t=>{this.selection.currentCell.text(t)})),this.$on("formula:done",(()=>this.selection.currentCell.focus())),this.$on("toolbar:applyStyle",(t=>{this.selection.applyStyling(t)}))}toHTML(){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=g.Z-g.A+1,r=[],i=new Array(n).fill("").map(C).map(function(t){return function(e){return n=e,r=w(t,e),'\n        <div class="column" data-col="'.concat(n,'" data-type="resizable" style="width: ').concat(r,'">\n            ').concat(n,'\n            <div class="col-resize" data-resize="col"></div>\n        </div> \n    ');var n,r}}(e)).join("");r.push($(0,i));for(let i=1;i<t+1;i++){const t=x(e,i),s=new Array(n).fill("").map(A(e,i)).join("");r.push($(i,s,t))}return r.join("")}(this.rowsCount,this.store.getState())}selectCell(t){this.selection.select(t),this.$emit("table:select",t)}async resizeTable(t){try{const n=await function(t,n){return new Promise((r=>{const i=e(n.target),s=i.data.resize;i.css({opacity:1});const o="col"===s?"bottom":"right";i.css({[o]:"-5000px"});const a=i.closest('[data-type="resizable"]'),c=a.getCoords();let l,u;l="col"===s?a.data.col:a.data.row,document.onmousemove=t=>{if("col"===s){const e=t.pageX-c.right;u=c.width+e,i.css({right:-e+"px"})}else{const e=t.pageY-c.bottom;u=c.height+e,i.css({bottom:-e+"px"})}},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,"col"===s?(a.css({width:u+"px"}),t.findAll("[data-col='".concat(l,"']")).forEach((t=>t.style.width=u+"px"))):(a.css({height:u+"px"}),t.findAll("[data-row='".concat(l,"']")).forEach((t=>t.style.height=u+"px"))),r({value:u,id:l,type:s}),i.css({opacity:0,bottom:0,right:0})}}))}(this.$root,t);this.$dispatch(function(t){return{type:_,data:t}}(n))}catch(t){console.warn(t.message)}}onMousedown(t){!function(t){return t.target.dataset.resize}(t)?function(t){return t.target.dataset.id}(t)&&function(t,n,r,i,s){if(function(t){return t.shiftKey}(n)){const e=r.currentCell.data.id,i=n.target.dataset.id,[s,o]=[e[0],i[0]].sort(((t,e)=>t.localeCompare(e))).map((t=>t.charCodeAt(0))),a=[];for(let t=0;t<o-s+1;t++)a.push(String.fromCharCode(s+t));const[c,l]=[+e.slice(1),+i.slice(1)].sort(((t,e)=>t-e)),u=[];for(let t=c;t<l+1;t++)u.push(t);const h=[];a.forEach((e=>{u.forEach((n=>{const r=e+n,i=t.find("[data-id=".concat(r,"]"));h.push(i)}))})),r.selectGroup(h)}else s(e(n.target))}(this.$root,t,this.selection,this.$emit.bind(this),this.selectCell.bind(this)):this.resizeTable(t)}onKeydown(t){const{key:e}=t;if(["Enter","Tab","ArrowLeft","ArrowRight","ArrowDown","ArrowUp"].includes(e)){t.preventDefault();const n=this.selection.currentCell.id(),r=this.$root.find(this.nextSelector(e,n));this.selectCell(r)}}storeChanged(t){}onInput(t){const n=e(t.target),r=n.text();var i;this.$emit("table:select",n),this.$dispatch((i={value:r,id:n.data.id},{type:L,data:i}))}nextSelector(t,e){let[n,r]=e,i=n.charCodeAt(0);switch(t){case"Enter":case"ArrowDown":r++;break;case"Tab":case"ArrowRight":n=String.fromCharCode(++i);break;case"ArrowLeft":n=String.fromCharCode(--i);break;case"ArrowUp":r--}return i>=65&&i<=90&&r>=1&&r<=this.rowsCount?'[data-id="'.concat(n).concat(r,'"]'):'[data-id="'.concat(e.join(""),'"]')}}j(T,"className","excel__table");const N=function(t){let e=t({...arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}},{type:"__INIT__"}),n=[];return{subscribe(t){return n.push(t),{unsubscribe(){n=n.filter((e=>e!==t))}}},dispatch(r){e=t(e,r),n.forEach((t=>t(e)))},getState(){return JSON.parse(JSON.stringify(e))}}}((function(t,e){let n,r,i;switch(e.type){case _:return"col"===e.data.type?(n=t.colState||{},n[e.data.id]=e.data.value,{...t,colState:n}):(r=t.rowState||{},r[e.data.id]=e.data.value,{...t,rowState:r});case L:return i=t.textState||{},i[e.data.id]=e.data.value,{...t,textState:i};default:return t}}),r("excel-state"));N.subscribe((t=>{r("excel-state",t)})),new class{constructor(t,r){this.$el=e(t),this.components=r.components||[],this.emitter=new n,this.store=r.store,this.subscriber=new i(this.store)}getRoot(){const t=e.create("div","excel"),n={emitter:this.emitter,store:this.store};return this.components=this.components.map((r=>{const i=e.create("div",r.className),s=new r(i,n);return i.html(s.toHTML()),t.append(i),s})),t}render(){this.$el.append(this.getRoot()),this.subscriber.subscribeComponents(this.components),this.components.forEach((t=>t.init()))}destroy(){this.subscriber.unsubscribeFromStore(),this.components.forEach((t=>t.destroy()))}}("#app",{components:[c,v,b,T],store:N}).render()}();